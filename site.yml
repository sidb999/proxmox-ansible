##!/usr/bin/env ansible-playbook
---
- name: Add ansible user
  hosts: debian
  tags: always
  become: true
  pre_tasks:
    - name: Add ansible user for ansible
      ansible.builtin.user:
        name: ansible
        group: root
  roles:
    - base
- name: Install necessary software for debian hosts
  hosts: debian
  remote_user: ansible
  become: true
  pre_tasks:
    - name: Install updates
      tags: always
      ansible.builtin.apt:
        update_cache: true
        upgrade: dist
  roles:
    - software_debian
- name: Install nfs server storage
  remote_user: ansible
  hosts: nfs_servers
  become: true
  pre_tasks:
    - name: Install nfs
      tags: nfs
      ansible.builtin.apt:
        update_cache: true
        name: nfs-kernel-server
  roles:
    - nfs
- name: Proxmox initial configuration
  hosts: proxmox
  remote_user: root
  roles:
    - proxmox_initial
- name: Add ansible user
  hosts: proxmox
  remote_user: root
  pre_tasks:
    - name: Add ansible user for ansible
      ansible.builtin.user:
        name: ansible
        group: root
  roles:
    - base
- name: Proxmox normal configuration
  hosts: proxmox
  remote_user: ansible
  roles:
    - proxmox_normal
